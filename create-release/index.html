<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Release | DynoPay</title>

  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:"Outfit",sans-serif;
    }

    body{
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
  padding-top:72px;
}


header{
  padding:12px 20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:#fff;
  border-bottom:1px solid #eee;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  z-index:9999;
}

header img{
  height:42px;
}

header.scrolled{
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

    /* CONTAINER */
    .wrap{
      width:92%;
      margin:18px auto;
      background:rgba(255,255,255,.95);
      border-radius:24px;
      padding:22px;
      box-shadow:0 20px 40px rgba(0,0,0,.18);
      animation:fade .4s ease;
    }

    @keyframes fade{
      from{opacity:0;transform:translateY(15px)}
      to{opacity:1}
    }

    /* STEPPER */
    .steps{
      display:flex;
      justify-content:space-between;
      margin-bottom:25px;
      position:relative;
    }

    .steps:before{
      content:"";
      position:absolute;
      top:50%;
      left:5%;
      right:5%;
      height:3px;
      background:#e5e7eb;
      z-index:0;
    }

    .step{
      width:38px;
      height:38px;
      border-radius:50%;
      background:#e5e7eb;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      color:#666;
      z-index:1;
    }

    .step.active{
      background:linear-gradient(135deg,#667eea,#764ba2);
      color:#fff;
      box-shadow:0 6px 18px rgba(102,126,234,.5);
    }

    /* FORM */
    .section{animation:fade .4s}

    .label{
      font-size:13px;
      font-weight:600;
      margin-bottom:6px;
    }

    .req{color:red}

    input,select{
      width:100%;
      padding:14px;
      border-radius:14px;
      border:1px solid #ddd;
      margin-bottom:16px;
      font-size:14px;
    }

    input:focus,select:focus{
      outline:none;
      border-color:#667eea;
      box-shadow:0 0 0 3px rgba(102,126,234,.15);
    }

    /* BUTTON */
    .btn{
      width:100%;
      padding:15px;
      border:none;
      border-radius:16px;
      font-weight:700;
      color:#fff;
      background:linear-gradient(135deg,#667eea,#764ba2);
    }

    .btn.gray{
      background:#e5e7eb;
      color:#111;
    }

    .btn:active{transform:scale(.96)}

    /* PREVIEW */
    .preview{
      background:#f9fafb;
      border-radius:16px;
      padding:16px;
      font-size:14px;
      line-height:1.7;
    }

    .preview div{margin-bottom:8px}
    .preview span{
      color:#667eea;
      font-weight:600;
    }
  </style>
</head>

<body>

<header id="mainHeader">
  <img src="../assets/dynopay2.png">
</header>

<div class="wrap">

  <!-- STEPS -->
  <div class="steps">
    <div class="step active" id="s1">1</div>
    <div class="step" id="s2">2</div>
    <div class="step" id="s3">3</div>
    <div class="step" id="s4">4</div>
  </div>

  <!-- STEP 1 -->
  <div id="step1" class="section">
    <div class="label">Type Asset <span class="req">*</span></div>
    <select id="type">
      <option value="">Select</option>
      <option value="original">Original Asset</option>
      <option value="cover">Cover Asset</option>
    </select>
    <button class="btn" onclick="next(1)">Continue</button>
  </div>

  <!-- STEP 2 -->
  <div id="step2" class="section" hidden></div>

  <!-- STEP 3 -->
  <div id="step3" class="section" hidden>
    <div class="label">Link GDrive Audio *</div>
    <input id="audio">

    <div class="label">Link GDrive Cover Art *</div>
    <input id="cover">

    <button class="btn gray" onclick="back(3)">Back</button><br><br>
    <button class="btn" onclick="next(3)">Preview</button>
  </div>

  <!-- STEP 4 -->
  <div id="step4" class="section" hidden>
    <div class="preview" id="previewBox"></div><br>

    <button class="btn gray" onclick="back(4)">Edit</button><br><br>
    <button class="btn" onclick="submitRelease()">Submit Release</button>
  </div>

</div>

<script>
/* MIN 7 HARI */
let d=new Date();
d.setDate(d.getDate()+7);

/* VALIDATION */
const stepsData={
  1:()=>type.value!="",

  2:()=>{
    if(type.value==="original"){
      return title.value && artist.value && genre.value &&
       releaseType.value && fullname.value &&
       label.value && release.value;
    }

    if(type.value==="cover"){
      return title.value && artist.value && genre.value &&
             publisher.value && composer.value;
    }
  },

  3:()=>audio.value && cover.value
}

/* LOAD STEP 2 FIELD */
function loadStep2Fields(){
  const s=document.getElementById("step2");
  s.innerHTML="";

  s.innerHTML+=`
    <div class="label">Song Title *</div>
    <input id="title">

    <div class="label">Artist Name *</div>
    <input id="artist">

    <div class="label">Genre *</div>
    <select id="genre">
      <option value="">Select</option>
      <option>Blues</option><option>Dangdut</option>
      <option>Electronic</option><option>Hip-hop</option>
      <option>Instrumental</option><option>Jazz</option>
      <option>Metal</option><option>Pop</option>
      <option>R&B</option><option>Reggae</option>
      <option>Rock</option>
    </select>
  `;

  if(type.value==="original"){
 s.innerHTML+=`

  <!-- RELEASE TYPE -->
  <div class="label">Release Type *</div>
  <select id="releaseType">
    <option value="">Pilih</option>
    <option>Single</option>
    <option>EP</option>
    <option>Album</option>
  </select>

  <!-- VERSION -->
  <div class="label">Version</div>
  <small style="font-size:11px;color:#777;">
    Contoh: Remix, Remastered, Live, dll
  </small>
  <input id="version" placeholder="Optional">

  <div class="label">Full Name *</div>
  <input id="fullname">

  <div class="label">Label *</div>
  <input id="label">

  <div class="label">Release Date *</div>
  <input type="date" id="release">
 `;

 setTimeout(()=>{
  let r=document.getElementById("release");
  let d=new Date();
  d.setDate(d.getDate()+7);
  r.min=d.toISOString().split("T")[0];
 },50);
}

  if(type.value==="cover"){
    s.innerHTML+=`
      <div class="label">Publisher *</div>
      <select id="publisher">
        <option value="">Select</option>
        <option>Nagaswara Official</option>
        <option>G2B Production</option>
        <option>Mahar Pustaka Nusantara</option>
      </select>

      <div class="label">Composer *</div>
      <input id="composer">
    `;
  }

  s.innerHTML+=`
    <button class="btn gray" onclick="back(2)">Back</button><br><br>
    <button class="btn" onclick="next(2)">Continue</button>
  `;
}

/* STEP CONTROL */
s1.onclick=()=>goto(1);
s2.onclick=()=>goto(2);
s3.onclick=()=>goto(3);
s4.onclick=()=>goto(4);

function goto(n){
  if(n>1 && !stepsData[n-1]())
    return alert("Lengkapi step sebelumnya dulu!");

  hideAll();
  document.getElementById("step"+n).hidden=false;
  active(n);
  if(n==4) loadPreview();
}

function next(n){
  if(n==1 && !stepsData[1]()) return alert("Type wajib");
  if(n==1) loadStep2Fields();

  if(n==2 && !stepsData[2]()) return alert("Lengkapi master");
  if(n==3 && !stepsData[3]()) return alert("Link wajib");

  goto(n+1);
}

function back(n){goto(n-1);}

function hideAll(){
  for(let i=1;i<=4;i++)
    document.getElementById("step"+i).hidden=true;
}

function active(n){
  for(let i=1;i<=4;i++)
    document.getElementById("s"+i).classList.remove("active");
  document.getElementById("s"+n).classList.add("active");
}

/* PREVIEW */
function loadPreview(){

  let html = `
    <div><span>Type:</span> ${type.value}</div>
    <div><span>Title:</span> ${title.value}</div>
    <div><span>Artist:</span> ${artist.value}</div>
    <div><span>Genre:</span> ${genre.value}</div>
    <div><span>Audio:</span> ${audio.value}</div>
    <div><span>Cover:</span> ${cover.value}</div>
  `;

  if(type.value==="original"){
    html += `
      <div><span>Release Type:</span> ${releaseType.value}</div>
      <div><span>Version:</span> ${version.value || "-"}</div>
      <div><span>Full Name:</span> ${fullname.value}</div>
      <div><span>Label:</span> ${label.value}</div>
      <div><span>Release Date:</span> ${release.value}</div>
    `;
  }

  if(type.value==="cover"){
    html += `
      <div><span>Publisher:</span> ${publisher.value}</div>
      <div><span>Composer:</span> ${composer.value}</div>
    `;
  }

  previewBox.innerHTML = html;
}
</script>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBRSkmZXbTPNupefSmjXvlKLDNsaeQ2zag",
  authDomain:"dynopay-2513c.firebaseapp.com",
  databaseURL:"https://dynopay-2513c-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db=firebase.database();

firebase.auth().onAuthStateChanged(user=>{
  if(!user) location.href="../login";
});

function submitRelease(){
 const user=firebase.auth().currentUser;
 if(!user) return;

 let data={
  type:type.value,
  title:title.value,
  artist:artist.value,
  genre:genre.value,
  audio:audio.value,
  cover:cover.value,
  status:"pending",
  time:Date.now()
 };

 if(type.value==="original"){
 data.releaseType = releaseType.value;
 data.version = version.value;
 data.fullname = fullname.value;
 data.label = label.value;
 data.release = release.value;
 }

 if(type.value==="cover"){
  data.publisher=publisher.value;
  data.composer=composer.value;
 }

 db.ref("releases/"+user.uid).push(data)
 .then(()=>location.href="../dynopay");
}

window.addEventListener("scroll",()=>{
  const h=document.getElementById("mainHeader");
  if(window.scrollY>5){
    h.classList.add("scrolled");
  }else{
    h.classList.remove("scrolled");
  }
});
</script>

</body>
</html>
