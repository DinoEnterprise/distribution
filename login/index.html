<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DynoPay Login</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Outfit',sans-serif}
body{
 margin:0;
 min-height:100vh;
 display:flex;
 justify-content:center;
 align-items:center;
 background:linear-gradient(135deg,#667eea,#764ba2);
 overflow:hidden;
}
/* CARD */
.container{
 width:90%;
 max-width:360px;
 background:#fff;
 border-radius:20px;
 padding:28px 22px;
 text-align:center;
 box-shadow:0 15px 30px rgba(0,0,0,.18);
 animation:enter .6s ease;
}
@keyframes enter{
 from{opacity:0;transform:translateY(40px)}
 to{opacity:1;transform:none}
}
/* LOGO */
.logo{width:70px;margin-bottom:14px;}
h2{margin:0 0 18px;font-size:22px;font-weight:700;color:#222;}
.field{position:relative;margin-bottom:12px}
input{
 width:100%;
 padding:13px 44px 13px 14px;
 border-radius:12px;
 border:1px solid #ddd;
 font-size:14px;
 outline:none;
}
input:focus{
 border-color:#667eea;
 box-shadow:0 0 0 3px rgba(102,126,234,.2);
}
.toggle{
 position:absolute;
 right:12px;
 top:50%;
 transform:translateY(-50%);
 cursor:pointer;
 opacity:.6;
}
button{
 width:100%;
 padding:14px;
 border:none;
 border-radius:14px;
 font-size:15px;
 font-weight:700;
 color:#fff;
 background:linear-gradient(90deg,#667eea,#764ba2);
 cursor:pointer;
}
button:active{transform:scale(.96)}
#error{
 margin-top:10px;
 font-size:13px;
 color:#e53e3e;
 min-height:18px;
}
.loader{
 position:fixed;
 inset:0;
 background:rgba(255,255,255,.9);
 display:flex;
 align-items:center;
 justify-content:center;
 font-weight:700;
 font-size:16px;
 color:#667eea;
 opacity:0;
 pointer-events:none;
 transition:.3s;
}
.loader.active{
 opacity:1;
 pointer-events:auto;
}
.fade-out{
 animation:exit .5s ease forwards;
}
@keyframes exit{
 to{opacity:0;transform:scale(.95)}
}
</style>
</head>

<body>

<div class="container" id="card">
  <img src="../assets/dyno2.png" class="logo" alt="DynoPay">
  <h2>Login DynoPay</h2>

  <div class="field">
    <input id="email" type="email" placeholder="Email">
  </div>

  <div class="field">
    <input id="pass" type="password" placeholder="Password">
    <div class="toggle" onclick="togglePass()">üëÅ</div>
  </div>

  <button onclick="login()">Masuk</button>
  <div id="error"></div>
</div>

<div class="loader" id="loader">Masuk ke DynoPay‚Ä¶</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* FIREBASE INIT */
firebase.initializeApp({
  apiKey: "AIzaSyBRSkmZXbTPNupefSmjXvlKLDNsaeQ2zag",
  authDomain: "dynopay-2513c.firebaseapp.com",
  databaseURL: "https://dynopay-2513c-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = firebase.database();

/* AUTO REDIRECT JIKA SUDAH LOGIN */
firebase.auth().onAuthStateChanged(user=>{
  if(user){
    window.location.replace("../dynopay");
  }
});

/* TOGGLE PASSWORD */
function togglePass(){
 const p=document.getElementById("pass");
 p.type=p.type==="password"?"text":"password";
}

/* LOGIN */
function login(){
 const email=document.getElementById("email").value.trim();
 const pass=document.getElementById("pass").value.trim();
 const errorEl=document.getElementById("error");

 if(!email||!pass){
  errorEl.textContent="Email dan password wajib diisi";
  return;
 }

 // SET SESSION PERSISTENCE (Remember Me)
 firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)
 .then(()=>{
   return firebase.auth().signInWithEmailAndPassword(email,pass);
 })
 .then(userCredential=>{
   const user = userCredential.user;

   // Simpan last login timestamp
   db.ref("users/"+user.uid+"/lastLogin").set(Date.now());

   document.getElementById("loader").classList.add("active");
   document.getElementById("card").classList.add("fade-out");
   setTimeout(()=>window.location.replace("../dynopay"),600);
 })
 .catch(error=>{
   switch(error.code){
     case "auth/user-not-found":
       errorEl.textContent="User tidak ditemukan";
       break;
     case "auth/wrong-password":
       errorEl.textContent="Password salah";
       break;
     case "auth/invalid-email":
       errorEl.textContent="Email tidak valid";
       break;
     default:
       errorEl.textContent="Terjadi kesalahan, coba lagi";
   }
 });
}
</script>

</body>
</html>
