<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Payment | Dynotic Distribution</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Outfit",sans-serif;}
body{
  background:#f1f2f7;
  min-height:100vh;
  padding:80px 0 40px;
}
header{
  position:fixed;
  top:0;left:0;width:100%;
  background:#fff;
  padding:14px 20px;
  border-bottom:1px solid #eee;
  z-index:10;
}
header span{
  font-weight:600;
  font-size:16px;
}
.card{
  width:90%;
  margin:auto;
  background:#fff;
  border-radius:20px;
  padding:25px;
  box-shadow:0 8px 18px rgba(0,0,0,.05);
}
.input-group{margin-bottom:15px;}
.input-group label{
  display:block;
  font-size:13px;
  margin-bottom:6px;
  font-weight:600;
}
.input-group input, select{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #ddd;
  font-size:14px;
  background:#f9f9f9;
  outline:none;
}
.input-group input:focus, select:focus{
  border-color:#667eea;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#111;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
button:active{transform:scale(0.96);}
</style>
</head>
<body>

<header>
  <span>Edit Payment Detail</span>
</header>

<div class="card">

  <div class="input-group">
    <label>Payment Method</label>
    <select id="method" onchange="toggleFields()">
      <option value="paypal">PayPal</option>
      <option value="bank">Bank Transfer</option>
    </select>
  </div>

  <!-- PayPal -->
  <div id="paypalField" class="input-group">
    <label>PayPal Email</label>
    <input type="email" id="paypalEmail" placeholder="example@email.com">
  </div>

  <!-- Bank -->
  <div id="bankField" style="display:none;">
    <div class="input-group">
      <label>Bank Name</label>
      <input type="text" id="bankName" placeholder="BCA / Mandiri / etc">
    </div>
    <div class="input-group">
      <label>Account Number</label>
      <input type="text" id="bankAccount" placeholder="1234567890">
    </div>
  </div>

  <button onclick="savePayment()">Save Changes</button>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyBRSkmZXbTPNupefSmjXvlKLDNsaeQ2zag",
  authDomain:"dynopay-2513c.firebaseapp.com",
  databaseURL:"https://dynopay-2513c-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const auth = firebase.auth();
const db = firebase.database();

auth.onAuthStateChanged(user=>{
  if(!user) location.href="../login";
  else loadPayment(user.uid);
});

function toggleFields(){
  const method = document.getElementById("method").value;
  document.getElementById("paypalField").style.display =
    method==="paypal" ? "block" : "none";
  document.getElementById("bankField").style.display =
    method==="bank" ? "block" : "none";
}

function loadPayment(uid){
  db.ref("users/"+uid+"/payment").once("value").then(snap=>{
    if(!snap.exists()) return;
    const d = snap.val();

    if(d.paypal){
      document.getElementById("method").value="paypal";
      document.getElementById("paypalEmail").value=d.email || "";
    }

    if(d.bank){
      document.getElementById("method").value="bank";
      document.getElementById("bankName").value=d.bank || "";
      document.getElementById("bankAccount").value=d.account || "";
    }

    toggleFields();
  });
}

function savePayment(){
  const user = auth.currentUser;
  if(!user) return;

  const method = document.getElementById("method").value;
  let paymentData = {};

  if(method==="paypal"){
    const email = document.getElementById("paypalEmail").value.trim();
    if(!email) return alert("Masukkan email PayPal");
    paymentData = {
      paypal:true,
      email:email
    };
  }

  if(method==="bank"){
    const bank = document.getElementById("bankName").value.trim();
    const account = document.getElementById("bankAccount").value.trim();
    if(!bank || !account) return alert("Lengkapi data bank");
    paymentData = {
      bank:bank,
      account:account
    };
  }

  db.ref("users/"+user.uid+"/payment").set(paymentData).then(()=>{
    alert("Payment updated!");
    location.href="../account";
  });
}
</script>

</body>
</html>
