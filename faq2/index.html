<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nazwa Chat - FAQ</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Outfit",sans-serif;}
html,body{height:100%;display:flex;flex-direction:column;color:#f5f3ff;
background:
radial-gradient(circle at 20% 30%, rgba(130,60,255,0.08), transparent 65%),
radial-gradient(circle at 80% 70%, rgba(150,70,255,0.06), transparent 70%),
#000;
overflow-x:hidden;}
body{user-select:none; pointer-events:auto;}

header{display:flex;align-items:center;justify-content:flex-start;padding:12px 15px;background:rgba(0,0,0,0.25);
backdrop-filter:blur(10px);border-radius:0 0 15px 15px;z-index:10;}

.avatar{width:50px;height:50px;border-radius:50%;background-image:url('../assets/nazwa.png');
background-size:cover;background-position:center;border:2px solid #fff;pointer-events:none;
user-select:none;box-shadow:0 0 8px #fff,0 0 15px rgba(168,85,247,0.4);animation:glow 2s infinite alternate;}

@keyframes glow{0%{box-shadow:0 0 8px #fff,0 0 15px rgba(168,85,247,0.2);}50%{box-shadow:0 0 12px #fff,0 0 20px rgba(168,85,247,0.5);}100%{box-shadow:0 0 8px #fff,0 0 15px rgba(168,85,247,0.2);}}

header .info{flex:1;margin-left:12px;}
header .info .name{font-weight:600;font-size:1rem;color:#fff;text-shadow:0 0 8px #fff,0 0 12px #fff;}
header .info .status{font-size:0.8rem;color:#fff;text-shadow:0 0 6px #fff;}

.chat-container{flex:1;background:rgba(255,255,255,0.05);backdrop-filter:blur(5px);padding:15px;margin:10px 12px;
border-radius:15px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;border:1px solid rgba(255,255,255,0.2);
scroll-behavior:smooth;}

.chat-bubble{max-width:75%;padding:12px 16px;border-radius:20px;font-size:0.95rem;word-wrap:break-word;
white-space:pre-wrap;display:flex;flex-direction:column;gap:2px;line-height:1.4rem;backdrop-filter:blur(5px);position:relative;cursor:pointer;}

.chat-bubble .time{font-size:0.7rem;color:rgba(255,255,255,0.7);align-self:flex-end;margin-top:0px;}

.bulan{background:rgba(168,85,247,0.3);color:#fff;border-top-left-radius:0;justify-content:flex-start;
box-shadow:0 0 10px rgba(168,85,247,0.3);}

.user{background:#111827;color:#fff;align-self:flex-end;border-top-right-radius:0;justify-content:flex-end;
box-shadow:0 0 10px rgba(37,99,235,0.4);}

.chat-bubble a{color:#3b82f6;text-decoration:underline;word-break:break-word;pointer-events:auto;}

#inputArea{display:flex;gap:10px;padding:10px 12px;border-top:1px solid rgba(255,255,255,0.3);
background:rgba(0,0,0,0.25);backdrop-filter:blur(10px);border-radius:12px 12px 0 0;}
#inputArea textarea{flex:1;padding:10px 14px;border-radius:15px;border:none;outline:none;font-size:0.95rem;
resize:none;height:40px;line-height:1.4rem;background:rgba(255,255,255,0.05);color:#fff;backdrop-filter:blur(5px);}
#inputArea button{padding:10px 14px;border-radius:12px;background:#2563eb;color:#fff;border:none;cursor:pointer;transition:all 0.25s ease;}
#inputArea button:hover{background:#1e40af;}

.typing{background:rgba(255,255,255,0.15);backdrop-filter:blur(5px);max-width:70%;padding:10px 14px;border-radius:20px;
display:inline-flex;align-items:center;gap:6px;color:#fff;box-shadow:0 0 8px rgba(168,85,247,0.3);}
.dots{display:flex;gap:4px;}
.dots div{width:6px;height:6px;background:#fff;border-radius:50%;animation:blink 1.4s infinite both;}
.dots div:nth-child(2){animation-delay:.2s;}
.dots div:nth-child(3){animation-delay:.4s;}
@keyframes blink{0%{opacity:.2}20%{opacity:1}100%{opacity:.2}}

@keyframes slideIn{from{opacity:0;transform:translateY(15px);} to{opacity:1;transform:translateY(0);}}
.animate-in{animation:slideIn .35s ease forwards;}

@media(max-width:480px){.avatar{width:40px;height:40px;}
header .info .name{font-size:0.9rem;}
header .info .status{font-size:0.7rem;}
.chat-bubble{max-width:85%; font-size:0.9rem; padding:10px 12px;}
#inputArea textarea{height:36px; font-size:0.9rem;}
#inputArea button{padding:8px 12px;}}
</style>
</head>
<body oncontextmenu="return false;">
<header>
  <div class="avatar"></div>
  <div class="info">
    <div class="name">Nazwa</div>
    <div class="status">Online</div>
  </div>
</header>

<div class="chat-container" id="chatContainer"></div>

<div id="inputArea">
  <textarea id="userInput" placeholder="Tanya sesuatu..."></textarea>
  <button onclick="sendMessage()">Kirim</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
(function(){ emailjs.init("TFIL1eBhlns1iw7ql"); })();

const firebaseConfig={
  apiKey:"AIzaSyAc_-F3iHn3gdpl2mqwT9uGgwL2pSipLW4",
  authDomain:"csbulan-997ea.firebaseapp.com",
  databaseURL:"https://csbulan-997ea-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"csbulan-997ea",
  storageBucket:"csbulan-997ea.appspot.com",
  messagingSenderId:"548129208386",
  appId:"1:548129208386:web:481ba552040813a39195db"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const chatContainer=document.getElementById("chatContainer");
const input=document.getElementById("userInput");

let userId=localStorage.getItem("userId");
if(!userId){userId="user-"+Date.now();localStorage.setItem("userId",userId);}

let emailSent=false;
function sendEmail(msg){if(emailSent) return; emailjs.send("service_xdb1jg3","template_q2n1g3b",{name:userId,time:new Date().toLocaleString(),message:msg}).then(()=>emailSent=true);}

function addBubble(msg,type,key,timestamp){
  const bubble=document.createElement("div");
  bubble.classList.add("chat-bubble",type,"animate-in");

  const linkifiedMsg = msg.replace(/(https?:\/\/[^\s]+)/g, url => `<a href="${url}" target="_blank">${url}<\/a>`);
  const textNode=document.createElement("div");
  textNode.innerHTML = linkifiedMsg;
  bubble.appendChild(textNode);

  const timeNode=document.createElement("span");
  const date = new Date(timestamp);
  const hours = String(date.getHours()).padStart(2,'0');
  const minutes = String(date.getMinutes()).padStart(2,'0');
  timeNode.innerText = hours + ":" + minutes;
  timeNode.className="time";
  bubble.appendChild(timeNode);

  bubble.addEventListener("click",(e)=>{
    if(e.target.tagName!=="A" && confirm("Hapus pesan ini?")){
      db.ref("chats/"+userId+"/"+key).remove();
      bubble.remove();
    }
  });

  chatContainer.appendChild(bubble);
  chatContainer.scrollTop=chatContainer.scrollHeight;
}

function sendMessage(){
  const msg=input.value.trim();
  if(!msg) return;
  db.ref("chats/"+userId).push({message:msg,type:"user",timestamp:Date.now()});
  sendEmail(msg);
  input.value="";
  showTyping();
}

function showTyping(){hideTyping(); const bubble=document.createElement("div");bubble.className="typing bulan animate-in";bubble.id="typing";
const dots=document.createElement("div");dots.className="dots";dots.innerHTML="<div></div><div></div><div></div>";bubble.appendChild(dots);
chatContainer.appendChild(bubble);chatContainer.scrollTop=chatContainer.scrollHeight;}

function hideTyping(){const el=document.getElementById("typing"); if(el) el.remove();}

db.ref("chats/"+userId).on("child_added",snap=>{
  const d=snap.val();
  hideTyping();
  addBubble(d.message,d.type==="user"?"user":"bulan",snap.key,d.timestamp);
});

window.addEventListener("DOMContentLoaded",()=>{
  db.ref("chats/"+userId).once("value",s=>{
    if(!s.exists()){
      db.ref("chats/"+userId).push({message:"Halo! Aku Nazwa. Ada yang bisa dibantu?",type:"bulan",timestamp:Date.now()});
    }
  });
});
</script>
</body>
</html>
