<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Withdraw | DynoPay</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Outfit",sans-serif;}
body{background:#f1f2f7;min-height:100vh;color:#111;animation:fadeIn .5s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(15px);}to{opacity:1;transform:translateY(0);}}

header{padding:12px 20px;display:flex;align-items:center;background:white;border-bottom:1px solid #eee;}
header img{height:50px;}

.card{
width:90%;
margin:20px auto;
background:#fff;
border-radius:20px;
padding:25px;
border:1px solid #ececec;
box-shadow:0 8px 18px rgba(0,0,0,.05);
}

input,button{
width:100%;
padding:12px;
margin-top:10px;
border-radius:12px;
border:1px solid #ddd;
font-size:14px;
}

button{
background:#111;
color:#fff;
border:none;
font-weight:600;
cursor:pointer;
}

.badge{
padding:4px 10px;
border-radius:20px;
font-size:12px;
color:#fff;
}

.pending{background:#f59e0b;}
.approved{background:#10b981;}

.item{
border-bottom:1px solid #eee;
padding:12px 0;
}

.bottom-nav{
background:#fff;
border-top:1px solid #eee;
padding:10px 0;
display:flex;
justify-content:space-around;
align-items:center;
position:fixed;
bottom:0;
left:0;
width:100%;
}

.nav-item{text-align:center;font-size:13px;opacity:.75;cursor:pointer;}
.nav-item img{width:28px;display:block;margin:auto;margin-bottom:4px;}
</style>
</head>

<body>

<header>
<img src="../assets/dynopay2.png">
</header>

<!-- FORM -->
<div class="card">
<h3>Withdraw</h3>
<small>Minimal Rp 50.000</small>

<div id="saldoText" style="margin-top:10px;font-weight:600"></div>

<input id="bank" placeholder="Nama Bank / E-Wallet">
<input id="rek" placeholder="Nomor Rekening">
<input id="nama" placeholder="Nama Pemilik Rekening">

<input id="jumlah" disabled>

<button onclick="requestWD()">Request Withdraw</button>
</div>

<!-- RIWAYAT -->
<div class="card">
<h3>Riwayat Withdraw</h3>
<div id="list"></div>
</div>

<div style="height:120px"></div>

<!-- NAV -->
<div class="bottom-nav">
<div class="nav-item" onclick="goDashboard()">
<img src="../assets/dasboard.png">Dashboard
</div>
<div class="nav-item">
<img src="../assets/withdraw.png">Withdraw
</div>
<div class="nav-item">
<img src="../assets/profile.png">Profile
</div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
apiKey:"AIzaSyBRSkmZXbTPNupefSmjXvlKLDNsaeQ2zag",
authDomain:"dynopay-2513c.firebaseapp.com",
databaseURL:"https://dynopay-2513c-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = firebase.database();
let saldo=0,uid="";

firebase.auth().onAuthStateChanged(user=>{
if(!user) location.href="../login";
uid=user.uid;

db.ref("users/"+uid).on("value",s=>{
saldo=Number(s.val().saldo||0);
saldoText.innerText="Saldo tersedia: Rp "+saldo.toLocaleString("id-ID");
jumlah.value="Rp "+saldo.toLocaleString("id-ID");
});

loadHistory();
});

function requestWD(){
if(saldo<50000){
alert("Minimal withdraw Rp 50.000");
return;
}

if(!bank.value||!rek.value||!nama.value){
alert("Lengkapi semua data!");
return;
}

const id=Date.now();

db.ref("withdraws/"+uid+"/"+id).set({
bank:bank.value,
rekening:rek.value,
nama:nama.value,
jumlah:saldo,
status:"pending",
waktu:Date.now()
});

alert("Request withdraw dikirim!");
}

function loadHistory(){
db.ref("withdraws/"+uid).on("value",s=>{
list.innerHTML="";
s.forEach(x=>{
const d=x.val();
list.innerHTML+=`
<div class="item">
<b>${d.bank}</b><br>
Rp ${d.jumlah.toLocaleString("id-ID")}
<span class="badge ${d.status}">
${d.status.toUpperCase()}
</span>
</div>`;
});
});
}

function goDashboard(){location.href="../dynopay";}
</script>

</body>
</html>
