<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DynoPay | Withdraw</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Outfit',sans-serif;}
body{background:#f1f2f7;min-height:100vh;color:#111;padding-bottom:120px;}
header{height:60px; display:flex; align-items:center; background:#fff; border-bottom:1px solid #eee; padding:0 20px;}
header img{height:36px;}
.container{width:90%; max-width:400px; margin:20px auto;}
.card{background:#fff; border-radius:20px; padding:25px; box-shadow:0 8px 18px rgba(0,0,0,.05); margin-bottom:20px;}
h2{margin-bottom:10px;}
.saldo-display{font-size:20px; font-weight:600; margin-bottom:15px;}
input{width:100%;padding:14px 16px;margin-bottom:14px;border-radius:12px;border:1px solid #ddd;font-size:14px;}
button{width:100%;padding:14px;border:none;border-radius:14px;background:linear-gradient(90deg,#667eea,#764ba2);color:#fff;font-weight:700;cursor:pointer;transition:.2s;}
button:active{transform:scale(.97);}
#message{margin-top:12px;font-size:14px;color:#111;text-align:center;}
.bottom-nav{background:#fff;border-top:1px solid #eee; padding:10px 0; display:flex; justify-content:space-around; align-items:center; position:fixed; bottom:0; left:0; width:100%;}
.nav-item{text-align:center;font-size:13px;opacity:.75;cursor:pointer;padding:4px 14px;border-radius:12px;transition:.25s;}
.nav-item img{width:28px; display:block; margin:auto; margin-bottom:4px;}
.nav-item:active{background:#e9ebf3;transform:scale(.95);}
.profile-menu{position:fixed;bottom:60px;right:20px;width:160px;background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.12);display:none;z-index:10;}
.profile-menu div{padding:12px 14px;cursor:pointer;border-bottom:1px solid #eee;font-size:14px;}
.profile-menu div:last-child{border-bottom:none;}
.profile-menu div:hover{background:#f1f2f7;}
</style>
</head>
<body>

<header>
  <img src="../assets/dynopay2.png" alt="DynoPay">
</header>

<div class="container">
  <div class="card">
    <div class="saldo-display" id="saldo">Saldo: Rp 0</div>
    <h2>Withdraw Request</h2>
    <input type="text" id="name" placeholder="Name">
    <input type="text" id="bank" placeholder="Bank / E-Wallet">
    <input type="text" id="account" placeholder="Account Number">
    <input type="number" id="amount" placeholder="Amount (Min 50.000)">
    <button onclick="submitWithdraw()">Request</button>
    <div id="message"></div>
  </div>
</div>

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <div class="nav-item" onclick="goDashboard()">
    <img src="../assets/dasboard.png" alt="Dashboard">
    Dashboard
  </div>
  <div class="nav-item" onclick="goWithdraw()">
    <img src="../assets/withdraw.png" alt="Withdraw">
    Withdraw
  </div>
  <div class="nav-item" onclick="toggleProfileMenu()">
    <img src="../assets/profile.png" alt="Profile">
    Profile
  </div>
</div>

<!-- PROFILE MENU -->
<div id="profileMenu" class="profile-menu">
  <div onclick="goSettings()">Settings</div>
  <div onclick="logout()">Log Out</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBRSkmZXbTPNupefSmjXvlKLDNsaeQ2zag",
  authDomain: "dynopay-2513c.firebaseapp.com",
  databaseURL: "https://dynopay-2513c-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = firebase.database();
let userSaldo = 0;

// proteksi login
firebase.auth().onAuthStateChanged(user=>{
  if(!user) window.location.href="../login";
  else{
    db.ref("users/" + user.uid).once("value").then(snap=>{
      if(snap.exists()) userSaldo = Number(snap.val().saldo || 0);
      updateSaldoDisplay();
    });
  }
});

// update saldo di layar
function updateSaldoDisplay(){
  document.getElementById("saldo").textContent = "Saldo: Rp " + userSaldo.toLocaleString("id-ID");
}

// submit withdraw
function submitWithdraw(){
  const name = document.getElementById("name").value.trim();
  const bank = document.getElementById("bank").value.trim();
  const account = document.getElementById("account").value.trim();
  const amount = Number(document.getElementById("amount").value);
  const message = document.getElementById("message");

  if(!name || !bank || !account || !amount){
    message.textContent="All fields are required.";
    return;
  }
  if(amount < 50000){
    message.textContent="Minimum withdrawal is 50.000";
    return;
  }
  if(amount > userSaldo){
    message.textContent="Insufficient balance";
    return;
  }

  const user = firebase.auth().currentUser;
  if(!user) return;

  db.ref("withdrawals").push({
    userId: user.uid,
    name:name,
    bank:bank,
    accountNumber:account,
    amount:amount,
    status:"pending",
    timestamp:Date.now()
  }).then(()=>{
    message.textContent="Withdraw request submitted!";
    document.getElementById("name").value="";
    document.getElementById("bank").value="";
    document.getElementById("account").value="";
    document.getElementById("amount").value="";
  }).catch(err=>message.textContent="Error: "+err.message);
}

// nav functions
function goDashboard(){ window.location.href="../dynopay"; }
function goWithdraw(){ window.location.href="./"; }
function goSettings(){ alert("Go to Settings"); }
function toggleProfileMenu(){
  const menu = document.getElementById("profileMenu");
  menu.style.display = menu.style.display==="block"?"none":"block";
}
function logout(){ firebase.auth().signOut().then(()=>{window.location.href="../login";}); }
</script>

</body>
</html>
