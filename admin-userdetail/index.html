<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Detail User - Dynotic Admin</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{
  font-family:'Outfit',sans-serif;
  background:#f1f2f7;
  margin:0;
  padding:15px;
}
.card{
  background:#fff;
  padding:15px;
  border-radius:12px;
  margin-bottom:15px;
  box-shadow:0 3px 10px rgba(0,0,0,.05);
}
h3{
  margin-bottom:10px;
}
ul{
  list-style:none;
  padding:0;
}
li{
  padding:6px 0;
  border-bottom:1px solid #eee;
}
button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:8px;
  background:#111;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
button:hover{
  opacity:.9;
}
</style>
</head>

<body>

<div class="card">
  <h3>Detail Member</h3>
  <p><strong>Email:</strong> <span id="email">-</span></p>
  <p><strong>Nama:</strong> <span id="nama">-</span></p>
  <p><strong>Last Login:</strong> <span id="lastLogin">-</span></p>
  <button id="resetBtn">Reset Password</button>
</div>

<div class="card">
  <h3>Payment Detail</h3>
  <p><strong>Method:</strong> <span id="paymentMethod">-</span></p>
  <p><strong>PayPal:</strong> <span id="paymentPaypal">-</span></p>
  <p><strong>Bank:</strong> <span id="paymentBank">-</span></p>
  <p><strong>Account:</strong> <span id="paymentAccount">-</span></p>
</div>

<div class="card">
  <h3>Registered Artists</h3>
  <ul id="artistList">
    <li>Loading...</li>
  </ul>
</div>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyBRSkmZXbTPNupefSmjXvlKLDNsaeQ2zag",
 authDomain:"dynopay-2513c.firebaseapp.com",
 databaseURL:"https://dynopay-2513c-default-rtdb.asia-southeast1.firebasedatabase.app"
});

const db = firebase.database();

// Ambil UID
const params = new URLSearchParams(window.location.search);
const uid = params.get("uid");

if(!uid){
  alert("UID tidak ditemukan di URL");
  throw new Error("UID kosong");
}

// Load user
db.ref("users/"+uid).once("value").then(snap=>{
  const data = snap.val();
  if(!data){
    alert("User tidak ditemukan");
    return;
  }

  document.getElementById("email").innerText = data.email || "-";
  document.getElementById("nama").innerText = data.nama || "-";
  document.getElementById("lastLogin").innerText = data.lastLogin
    ? new Date(data.lastLogin).toLocaleString()
    : "-";

  // Reset password
  document.getElementById("resetBtn").onclick = ()=>{
    if(confirm("Kirim email reset password?")){
      firebase.auth().sendPasswordResetEmail(data.email)
      .then(()=>alert("Email reset terkirim"))
      .catch(err=>alert(err.message));
    }
  };

  // Reset payment dulu
  document.getElementById("paymentMethod").innerText = "-";
  document.getElementById("paymentPaypal").innerText = "-";
  document.getElementById("paymentBank").innerText = "-";
  document.getElementById("paymentAccount").innerText = "-";

  if(data.payment){
    if(data.payment.paypal){
      document.getElementById("paymentMethod").innerText = "PayPal";
      document.getElementById("paymentPaypal").innerText = data.payment.email || "-";
    }
    if(data.payment.bank){
      document.getElementById("paymentMethod").innerText = "Bank Transfer";
      document.getElementById("paymentBank").innerText = data.payment.bank || "-";
      document.getElementById("paymentAccount").innerText = data.payment.account || "-";
    }
  }else{
    document.getElementById("paymentMethod").innerText = "Belum diatur";
  }
});

// Load artists
db.ref("releases/"+uid).once("value").then(snap=>{
  const list = document.getElementById("artistList");
  list.innerHTML = "";

  if(!snap.exists()){
    list.innerHTML = "<li>Belum ada artis</li>";
    return;
  }

  const set = new Set();
  snap.forEach(r=>{
    const d = r.val();
    if(d.artist) set.add(d.artist);
  });

  if(set.size === 0){
    list.innerHTML = "<li>Belum ada artis</li>";
  }else{
    set.forEach(name=>{
      const li = document.createElement("li");
      li.innerText = name;
      list.appendChild(li);
    });
  }
});
</script>

</body>
</html>
